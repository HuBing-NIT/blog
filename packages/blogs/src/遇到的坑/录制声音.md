---
title: 录制声音
order: 2
nav:
  title: 个人
  path: /blogs
group:
  title: 遇到的坑
  path: /遇到的坑
  order: 2
---

# 2. 录制声音

```javascript
import React from 'react';

export default class MicTest extends React.Component<Iprops, IState> {
  recorder: MediaRecorder = null;
  renderElemt: HTMLAudioElement;

  chunks: any = [];

  saveRecordingData = () => {
    const blob = new Blob(this.chunks, { type: 'audio/ogg; codecs=opus' });
    const audioStream = URL.createObjectURL(blob);

    // 将steram赋值给audio节点
    this.renderElemt.src = audioStream;
    if (this.props.micEnable) {
      // 播放录制的声音
      this.renderElemt.play();
      this.bindAudioEvent();
    }

    this.chunks = [];
  };
  getRecordingData = (e) => {
    //录制的数据
    this.chunks.push(e.data);
  };
  bindEvents = () => {
    this.recorder.ondataavailable = this.getRecordingData;
    this.recorder.onstop = this.saveRecordingData;
  };
  startTranscribeAudio = () => {
    // 点击开始录制
    navigator.mediaDevices
      .getUserMedia({
        audio: {
          deviceId: this.props.micId,
        },
      })
      .then(
        (stream) => {
          //创建媒体录制对象
          this.recorder = new MediaRecorder(stream);
          this.recorder.start();
          this.bindEvents();
        },
        (error) => {
          alert('出错，请确保已允许浏览器获取录音权限');
        },
      );
  };
  bindAudioEvent = () => {
    this.renderElemt.onended = () => {};
  };
  startPlayAudio = () => {
    this.startTranscribeAudio();
  };
  stopRecordAudio = () => {
    this.recorder.stop();
  };
  render() {
    return (
      <div className="m-micTest">
        <div className="m-micTestContent">
          <div className="m-micTestBtn" onClick={this.startPlayAudio}>
            // 1.点击开始录制声音
          </div>
        </div>
        <p>{'DevTestTooltip'.locales()}</p>
        <audio
          id="audioTranscribe"
          controls
          ref={(ref) => {
            this.renderElemt = ref;
          }}
        />
      </div>
    );
  }
}
```
